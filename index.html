<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Spreadsheet Viewer</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="brand">
        <div class="logo">⚾</div>
        <div>Spreadsheet Viewer</div>
      </div>
    </div>

    <div class="panel">
      <div class="toolbar">
        <label>
          <span style="font-size:12px;color:#a7b0be;display:block;margin-bottom:4px;">Sheet</span>
          <select id="sheetSelect"></select>
        </label>

        <label style="flex:1; min-width: 220px;">
          <span style="font-size:12px;color:#a7b0be;display:block;margin-bottom:4px;">Search</span>
          <input type="text" id="searchInput" placeholder="Type to filter rows..." />
        </label>

        <label>
          <span style="font-size:12px;color:#a7b0be;display:block;margin-bottom:4px;">Rows per page</span>
          <select id="pageSize">
            <option>10</option>
            <option selected>25</option>
            <option>50</option>
            <option>100</option>
          </select>
        </label>

        <button class="btn" id="resetBtn">Reset</button>
      </div>

      <div class="table-wrap">
        <table id="table">
          <thead></thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="status">
        <div id="statusText">Ready.</div>
        <div>
          <button class="btn" id="prevBtn">Prev</button>
          <button class="btn" id="nextBtn">Next</button>
        </div>
      </div>
    </div>

    <div class="footer">Static site generated from Excel. Upload to GitHub Pages, Netlify, or any static host.</div>
  </div>

<script>
const SHEETS = ["Sheet1"];
const DEFAULT_SHEET = "Sheet1";

const state = {
  sheet: DEFAULT_SHEET,
  columns: [],
  rows: [],
  filtered: [],
  sortKey: null,
  sortDir: 1,
  page: 0,
  pageSize: 25
};

const els = {
  sheetSelect: document.getElementById('sheetSelect'),
  searchInput: document.getElementById('searchInput'),
  pageSize: document.getElementById('pageSize'),
  tableHead: document.querySelector('#table thead'),
  tableBody: document.querySelector('#table tbody'),
  statusText: document.getElementById('statusText'),
  prevBtn: document.getElementById('prevBtn'),
  nextBtn: document.getElementById('nextBtn'),
  resetBtn: document.getElementById('resetBtn'),
};

function fmt(v) {
  if (v === null || v === undefined) return '';
  return String(v);
}

async function loadSheet(name) {
  const res = await fetch(`data/${name}.json`);
  const data = await res.json();
  state.sheet = name;
  state.columns = data.columns;
  state.rows = data.rows;
  state.filtered = data.rows;
  state.sortKey = null;
  state.sortDir = 1;
  state.page = 0;
  render();
}

function applySearch() {
  const q = els.searchInput.value.trim().toLowerCase();
  if (!q) {
    state.filtered = state.rows;
  } else {
    state.filtered = state.rows.filter(r =>
      state.columns.some(c => (fmt(r[c]).toLowerCase().includes(q)))
    );
  }
  state.page = 0;
}

function sortBy(col) {
  if (state.sortKey === col) {
    state.sortDir = -state.sortDir;
  } else {
    state.sortKey = col;
    state.sortDir = 1;
  }
  const dir = state.sortDir;
  state.filtered = [...state.filtered].sort((a, b) => {
    const av = a[col] ?? '';
    const bv = b[col] ?? '';
    // numeric-aware compare
    const an = parseFloat(av);
    const bn = parseFloat(bv);
    const aNum = !isNaN(an) && String(av).trim() !== '';
    const bNum = !isNaN(bn) && String(bv).trim() !== '';
    if (aNum && bNum) return (an - bn) * dir;
    return String(av).localeCompare(String(bv)) * dir;
  });
  state.page = 0;
  renderTableBody();
}

function paginateRows() {
  const start = state.page * state.pageSize;
  const end = start + state.pageSize;
  return state.filtered.slice(start, end);
}

function renderTableHead() {
  const tr = document.createElement('tr');
  state.columns.forEach(c => {
    const th = document.createElement('th');
    th.textContent = c;
    th.title = "Click to sort";
    th.addEventListener('click', () => sortBy(c));
    if (state.sortKey === c) {
      const ind = document.createElement('span');
      ind.className = 'sort-ind';
      ind.textContent = state.sortDir === 1 ? '▲' : '▼';
      th.appendChild(ind);
    }
    tr.appendChild(th);
  });
  els.tableHead.innerHTML = '';
  els.tableHead.appendChild(tr);
}

function renderTableBody() {
  const rows = paginateRows();
  els.tableBody.innerHTML = '';
  for (const r of rows) {
    const tr = document.createElement('tr');
    for (const c of state.columns) {
      const td = document.createElement('td');
      td.textContent = fmt(r[c]);
      tr.appendChild(td);
    }
    els.tableBody.appendChild(tr);
  }
}

function renderStatus() {
  const total = state.filtered.length;
  const start = total === 0 ? 0 : (state.page * state.pageSize + 1);
  const end = Math.min(total, (state.page + 1) * state.pageSize);
  els.statusText.textContent = `${state.sheet} — Showing ${start}–${end} of ${total}`;
}

function render() {
  renderTableHead();
  renderTableBody();
  renderStatus();
}

function populateSheetSelect() {
  SHEETS.forEach(s => {
    const opt = document.createElement('option');
    opt.value = s;
    opt.textContent = s;
    if (s === DEFAULT_SHEET) opt.selected = true;
    els.sheetSelect.appendChild(opt);
  });
}

els.sheetSelect.addEventListener('change', () => loadSheet(els.sheetSelect.value));
els.searchInput.addEventListener('input', () => { applySearch(); render(); });
els.pageSize.addEventListener('change', () => { state.pageSize = parseInt(els.pageSize.value, 10); state.page = 0; render(); });
els.prevBtn.addEventListener('click', () => { state.page = Math.max(0, state.page - 1); render(); });
els.nextBtn.addEventListener('click', () => {
  const maxPage = Math.floor((state.filtered.length - 1) / state.pageSize);
  state.page = Math.min(maxPage, state.page + 1);
  render();
});

els.resetBtn.addEventListener('click', () => {
  els.searchInput.value = '';
  state.page = 0;
  state.sortKey = null;
  state.sortDir = 1;
  state.filtered = state.rows;
  render();
});

populateSheetSelect();
loadSheet(DEFAULT_SHEET);
</script>
</body>
</html>
